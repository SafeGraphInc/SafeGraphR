<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Adjust SafeGraph Data for Sampling Size Differences — sample_size_adjust • SafeGraphR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Adjust SafeGraph Data for Sampling Size Differences — sample_size_adjust"><meta property="og:description" content="This function uses 2016 American Community Survey data to adjust SafeGraph counts for the portion of the population that is sampled. This function will return a data.table with columns for a geographic ID and the variable adjust_factor, which you can merge into your data and then multiply whatever count variables you like by adjust_factor to adjust them for sampling differences."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SafeGraphR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.5.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/SafeGraphR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Automatic_Traffic-over-Time_Processing.html">Automatic Traffic-over-Time Processing</a>
    </li>
    <li>
      <a href="../articles/distancing_vignette.html">Processing and Using SafeGraph Stay-at-Home Data</a>
    </li>
    <li>
      <a href="../articles/patterns_vignette.html">Processing and Using SafeGraph Patterns Data</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Adjust SafeGraph Data for Sampling Size Differences</h1>
    
    <div class="hidden name"><code>sample_size_adjust.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function uses 2016 American Community Survey data to adjust SafeGraph counts for the portion of the population that is sampled. This function will return a <code>data.table</code> with columns for a geographic ID and the variable <code>adjust_factor</code>, which you can merge into your data and then multiply whatever count variables you like by <code>adjust_factor</code> to adjust them for sampling differences.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">sample_size_adjust</span><span class="op">(</span>
  <span class="va">data</span>,
  from_id <span class="op">=</span> <span class="st">"census_block_group"</span>,
  sample_id <span class="op">=</span> <span class="st">"number_devices_residing"</span>,
  from_level <span class="op">=</span> <span class="st">"cbg"</span>,
  to_level <span class="op">=</span> <span class="st">"county"</span>,
  by <span class="op">=</span> <span class="cn">NULL</span>,
  pop_data <span class="op">=</span> <span class="cn">NULL</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p>A <code>data.frame</code> (or <code>tibble</code> or <code>data.table</code>) containing (among other things potentially) geographic ID variables and a variable for the number of SafeGraph devices observed in that area. Often this is from a <code>home-panel-summary</code> file.</p></dd>
<dt>from_id</dt>
<dd><p>A character vector either giving the variable name of the census block group ID, or both the state FIPS and county FIPS variables (which must be numeric, and in state, then county order). Census block group must be specified if <code>from_level='cbg'</code>.</p></dd>
<dt>sample_id</dt>
<dd><p>A character variable giving the variable name of the variable in <code>data</code> that has the number of SafeGraph observations.</p></dd>
<dt>from_level</dt>
<dd><p>Either <code>'cbg'</code> or <code>'county'</code>, indicating the geographic level that is to be adjusted.</p></dd>
<dt>to_level</dt>
<dd><p>Either <code>'county'</code> or <code>'state'</code>, indicating the geographic level that the <code>from_level</code> components are to be adjusted to, for example <code>from_level='county'</code> and <code>to_level='state'</code> wouuld give an adjustment factor for each county as though each county in the state was sampled at the same rate.</p></dd>
<dt>by</dt>
<dd><p>The data returned will be on the <code>from_level</code> level. Specify other vairables here to have it instead be on the <code>from_level</code>-<code>by</code> level, perhaps a timecode. <code>by</code> should not split the <code>from_level</code> counts. If, for example, <code>by</code> is used to split a county in two geographic subcounties, then the population adjustment will not be correct.</p></dd>
<dt>pop_data</dt>
<dd><p>If a populatinon data file other than <code>data(cbg_pop)</code> or <code>data(county_pop)</code> should be used, enter it here. Should be in the same format, and with the same variable names, as <code>cbg_pop</code> if <code>from_level='cbg'</code>, or the same as <code>county_pop</code> if <code>from_level='county'</code>.</p></dd>
</dl></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="co"># The current working directory has many home_panel_summary files</span></span>
<span class="r-in"><span class="co"># Do some futzing with the census_block_group variable to</span></span>
<span class="r-in"><span class="co"># Get it in the same format as how it is in cbg_pop</span></span>
<span class="r-in"><span class="va">home_panel</span> <span class="op">&lt;-</span> <span class="fu"><a href="read_many_csvs.html">read_many_csvs</a></span><span class="op">(</span>colClasses<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>census_block_group<span class="op">=</span><span class="st">'character'</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="va">home_panel</span><span class="op">[</span>,<span class="va">census_block_group</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">census_block_group</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Create the data set with the adjust_factor variable</span></span>
<span class="r-in"><span class="co"># This will adjust CBG populations to county ones, by default</span></span>
<span class="r-in"><span class="va">adj_factor</span> <span class="op">&lt;-</span> <span class="fu">sample_size_adjust</span><span class="op">(</span><span class="va">home_panel</span>, by <span class="op">=</span> <span class="st">'date_range_start'</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># Now take some distancing data I have</span></span>
<span class="r-in"><span class="co"># (where census_block_group is stored as origin_census_block_group)</span></span>
<span class="r-in"><span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setattr.html" class="external-link">setnames</a></span><span class="op">(</span><span class="va">adj_factor</span>, <span class="va">census_block_group</span>, <span class="va">origin_census_block_group</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># and merge in the adjustment factor</span></span>
<span class="r-in"><span class="va">distancing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge</a></span><span class="op">(</span><span class="va">distancing</span>, <span class="va">adj_factor</span>, all.x <span class="op">=</span> <span class="cn">TRUE</span>, by <span class="op">=</span> <span class="st">'origin_census_block_group'</span><span class="op">)</span></span>
<span class="r-in"><span class="co"># And use that adjustment factor to adjust!</span></span>
<span class="r-in"><span class="va">distancing</span><span class="op">[</span>,<span class="va">adj_device_count</span> <span class="op">:=</span> <span class="va">device_count</span><span class="op">*</span><span class="va">adj_factor</span><span class="op">]</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="op">}</span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Nick Huntington-Klein.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

