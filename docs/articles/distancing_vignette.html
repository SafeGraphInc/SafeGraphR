<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Processing and Using SafeGraph Stay-at-Home Data • SafeGraphR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Processing and Using SafeGraph Stay-at-Home Data">
<meta property="og:description" content="SafeGraphR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SafeGraphR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/SafeGraphR.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Automatic_Traffic-over-Time_Processing.html">Automatic Traffic-over-Time Processing</a>
    </li>
    <li>
      <a href="../articles/distancing_vignette.html">Processing and Using SafeGraph Stay-at-Home Data</a>
    </li>
    <li>
      <a href="../articles/patterns_vignette.html">Processing and Using SafeGraph Patterns Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="distancing_vignette_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Processing and Using SafeGraph Stay-at-Home Data</h1>
            
      
      
      <div class="hidden name"><code>distancing_vignette.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">SafeGraphR</span><span class="op">)</span></code></pre></div>
<p>This vignette will walk you through the process of reading in, processing, and displaying SafeGraph stay-at-home data.</p>
<p>Note that the stay-at-home-data is <strong>no longer being updated</strong> as of April 19, 2021. However, this should work for the old data.</p>
<p>This vignette will work with data from the <em>social-distancing/v2/</em> SafeGraph Amazon Web Services bucket (see the <a href="https://catalog.safegraph.io">SafeGraph Catalog</a> for more information), which could also be downloaded using <code><a href="../reference/safegraph_aws.html">safegraph_aws()</a></code>.</p>
<p>Note that throughout this vignette, we will be working with data manipulation using the <strong>data.table</strong> package. <strong>data.table</strong> is used throughout <strong>SafeGraphR</strong> (and on the backend) because it is very fast and can handle large data sets easily. However, once the data is read in and processed, it’s often no longer necessary to use <strong>data.table</strong> if you prefer something else. The code in this vignette could have easily used, for example, <strong>dplyr</strong> instead. If you are having trouble understanding the code chunks because you’re familiar with <strong>dplyr</strong> but not <strong>data.table</strong>, see <a href="https://atrebas.github.io/post/2019-03-03-datatable-dplyr/">this guide</a> that links the two.</p>
<hr>
<div id="reading-in-data" class="section level1">
<h1 class="hasAnchor">
<a href="#reading-in-data" class="anchor"></a>Reading in Data</h1>
<p>We will read in the distancing data using the <code><a href="../reference/read_distancing.html">read_distancing()</a></code> function. This relies on the files in the <code>social-distancing/v2</code> bucket in the Amazon Web Services bucket, which you can download using <code><a href="../reference/safegraph_aws.html">safegraph_aws()</a></code> (or using the AWS CLI). See the <a href="https://catalog.safegraph.io">SafeGraph Catalog</a>.</p>
<p>Once we’ve downloaded it, the files will be in a YEAR/MONTH/DAY/FILE structure. We can tell it where to begin and end reading files (we probably don’t want ALL the files - that would be very large!) by specifying a <code>start</code> and <code>end</code> date. Let’s get all the data from June 1 to June 14, 2020.</p>
<p><strong>IMPORTANT</strong>: by default, <code><a href="../reference/read_distancing.html">read_distancing()</a></code> will only <code>select</code> the variables necessary to get stay-at-home percentages, and will aggregate <code>by</code> the state and county level. If you want more variables from the data, change <code>select</code>. And if you want the original raw census block group-level data (<code>origin_census_block_group</code>), change <code>by</code>. There is also an option to <code>filter</code> the data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Our working directory is in the same folder as the "2020" folder</span>
<span class="va">distancing</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_distancing.html">read_distancing</a></span><span class="op">(</span>
   start <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2020-06-01'</span><span class="op">)</span>,
   end <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/ymd.html">ymd</a></span><span class="op">(</span><span class="st">'2020-06-14'</span><span class="op">)</span>
<span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">distancing</span><span class="op">)</span>
<span class="va">distancing</span><span class="op">[</span><span class="op">]</span>
<span class="co">#&gt;        state_fips county_fips device_count completely_home_device_count</span>
<span class="co">#&gt;     1:          1         053         2735                          704</span>
<span class="co">#&gt;     2:          1         073        55056                        15661</span>
<span class="co">#&gt;     3:          1         089        30082                         9208</span>
<span class="co">#&gt;     4:          1         095         8557                         2147</span>
<span class="co">#&gt;     5:          1         097        32792                         9484</span>
<span class="co">#&gt;    ---                                                                 </span>
<span class="co">#&gt; 45154:         35         021           42                            8</span>
<span class="co">#&gt; 45155:         32         009           61                           17</span>
<span class="co">#&gt; 45156:         48         433          137                           35</span>
<span class="co">#&gt; 45157:         48         359          211                           44</span>
<span class="co">#&gt; 45158:         31         171           52                            9</span>
<span class="co">#&gt;        part_time_work_behavior_devices full_time_work_behavior_devices</span>
<span class="co">#&gt;     1:                             169                              38</span>
<span class="co">#&gt;     2:                            2818                             792</span>
<span class="co">#&gt;     3:                            1510                             331</span>
<span class="co">#&gt;     4:                             520                              94</span>
<span class="co">#&gt;     5:                            1912                             461</span>
<span class="co">#&gt;    ---                                                                </span>
<span class="co">#&gt; 45154:                               3                               1</span>
<span class="co">#&gt; 45155:                               2                               2</span>
<span class="co">#&gt; 45156:                              11                               4</span>
<span class="co">#&gt; 45157:                              25                               3</span>
<span class="co">#&gt; 45158:                               1                               1</span>
<span class="co">#&gt;              date</span>
<span class="co">#&gt;     1: 2020-06-14</span>
<span class="co">#&gt;     2: 2020-06-14</span>
<span class="co">#&gt;     3: 2020-06-14</span>
<span class="co">#&gt;     4: 2020-06-14</span>
<span class="co">#&gt;     5: 2020-06-14</span>
<span class="co">#&gt;    ---           </span>
<span class="co">#&gt; 45154: 2020-06-01</span>
<span class="co">#&gt; 45155: 2020-06-01</span>
<span class="co">#&gt; 45156: 2020-06-01</span>
<span class="co">#&gt; 45157: 2020-06-01</span>
<span class="co">#&gt; 45158: 2020-06-01</span></code></pre></div>
<hr>
</div>
<div id="processing-data" class="section level1">
<h1 class="hasAnchor">
<a href="#processing-data" class="anchor"></a>Processing Data</h1>
<p>We will be calculating and using the percentage of each county that is staying home, which is <code>completely_home_device_count/device_count</code>, but we may need to do some adjustments.</p>
<p>We have a few goals at this point:</p>
<ol style="list-style-type: decimal">
<li>Do any further aggregation or adjustments we like</li>
<li>Smooth out weekend effects</li>
<li>Make the data presentable!</li>
</ol>
<div id="do-any-further-aggregation-or-adjustments-we-like" class="section level2">
<h2 class="hasAnchor">
<a href="#do-any-further-aggregation-or-adjustments-we-like" class="anchor"></a>1. Do any further aggregation or adjustments we like</h2>
<p>Any additional adjustments that we do depend on the level we want the eventual data at. If we want to aggregate the data up to a higher level (perhaps to get stay-at-home by state), we might want to do <code><a href="../reference/sample_size_adjust.html">sample_size_adjust()</a></code> to account for different sampling rates across regions. See the Patterns Vignette for an example of using <code><a href="../reference/sample_size_adjust.html">sample_size_adjust()</a></code>.</p>
<p>If instead we want to report the granular individual-level data, we should perform Bayesian shrinkage with <code><a href="../reference/hb_shrink.html">hb_shrink()</a></code>. so that we don’t get strange results from small regions with few people in them.</p>
<p>Hierarchical Bayesian shrinkage basically says “we’re going to start by assuming that you, the individual county, are exactly the same as the overall state. Then we adjust that assumption by looking at your individual data. If you’re small, we won’t adjust much, since we don’t see much from you. But if you’re big, we adjust a lot.” We will be doing this to shrink counties to states, but you could instead shrink census block groups to counties or states.</p>
<p><code><a href="../reference/hb_shrink.html">hb_shrink()</a></code> is a shrinkage function that only works with proportions. Conveniently, “the proportion staying home” is a proportion! Note, by the way, that if we had CBG-level data but wanted the eventual data at the county level, shrunk to the state level, we would <code>sum</code> up <code>completely_home_device_count</code> and <code>device_count</code> to the county level <em>before</em> using <code><a href="../reference/hb_shrink.html">hb_shrink()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">distancing</span> <span class="op">&lt;-</span> <span class="va">distancing</span><span class="op">[</span>,<span class="fu">.</span><span class="op">(</span>county_fips <span class="op">=</span> <span class="va">county_fips</span>,
                            completely_home_device_count <span class="op">=</span> <span class="va">completely_home_device_count</span>,
                            device_count <span class="op">=</span> <span class="va">device_count</span>,
                            raw_stay_home <span class="op">=</span> <span class="va">completely_home_device_count</span><span class="op">/</span><span class="va">device_count</span>,
                            shrunk_stay_home <span class="op">=</span> <span class="fu"><a href="../reference/hb_shrink.html">hb_shrink</a></span><span class="op">(</span><span class="va">completely_home_device_count</span>,<span class="va">device_count</span><span class="op">)</span><span class="op">)</span>,
                         by <span class="op">=</span> <span class="fu">.</span><span class="op">(</span><span class="va">state_fips</span>, <span class="va">date</span><span class="op">)</span><span class="op">]</span>
<span class="va">distancing</span><span class="op">[</span><span class="op">]</span>
<span class="co">#&gt;        state_fips       date county_fips completely_home_device_count</span>
<span class="co">#&gt;     1:          1 2020-06-14         053                          704</span>
<span class="co">#&gt;     2:          1 2020-06-14         073                        15661</span>
<span class="co">#&gt;     3:          1 2020-06-14         089                         9208</span>
<span class="co">#&gt;     4:          1 2020-06-14         095                         2147</span>
<span class="co">#&gt;     5:          1 2020-06-14         097                         9484</span>
<span class="co">#&gt;    ---                                                               </span>
<span class="co">#&gt; 45154:         78 2020-06-01         010                          433</span>
<span class="co">#&gt; 45155:         78 2020-06-01         030                          381</span>
<span class="co">#&gt; 45156:         78 2020-06-01         020                           27</span>
<span class="co">#&gt; 45157:         69 2020-06-01         110                           36</span>
<span class="co">#&gt; 45158:         69 2020-06-01         120                            6</span>
<span class="co">#&gt;        device_count raw_stay_home shrunk_stay_home</span>
<span class="co">#&gt;     1:         2735     0.2574040        0.2567292</span>
<span class="co">#&gt;     2:        55056     0.2844558        0.2843217</span>
<span class="co">#&gt;     3:        30082     0.3060967        0.3057083</span>
<span class="co">#&gt;     4:         8557     0.2509057        0.2508285</span>
<span class="co">#&gt;     5:        32792     0.2892169        0.2889632</span>
<span class="co">#&gt;    ---                                            </span>
<span class="co">#&gt; 45154:         1125     0.3848889        0.3832164</span>
<span class="co">#&gt; 45155:         1055     0.3611374        0.3600957</span>
<span class="co">#&gt; 45156:          114     0.2368421        0.2576238</span>
<span class="co">#&gt; 45157:          109     0.3302752        0.3432126</span>
<span class="co">#&gt; 45158:           13     0.4615385        0.4173651</span></code></pre></div>
</div>
<div id="smooth-out-weekend-effects-and-scale" class="section level2">
<h2 class="hasAnchor">
<a href="#smooth-out-weekend-effects-and-scale" class="anchor"></a>2. Smooth out weekend effects and scale</h2>
<p>Next we will likely want to smooth things out and handle day-of-week effects by using the <code><a href="../reference/ma.html">ma()</a></code> moving average function. Don’t forget to sort first!</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Not actually run since we only have 14 days of data here anyway</span>
<span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setorder.html">setorder</a></span><span class="op">(</span><span class="va">distancing</span>, <span class="va">state_fips</span>, <span class="va">county_fips</span>, <span class="va">date</span><span class="op">)</span>
<span class="va">distancing</span><span class="op">[</span>, <span class="va">shrunk_stay_home</span> <span class="op">:=</span> <span class="fu"><a href="../reference/ma.html">ma</a></span><span class="op">(</span><span class="va">shrunk_stay_home</span><span class="op">)</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'state_fips'</span>, <span class="st">'county_fips'</span><span class="op">)</span><span class="op">]</span></code></pre></div>
<p>Now we may want to consider scaling the data relative to a specific date in the past. This isn’t as necessary for distancing data as it is for patterns data, but it can make things easier to compare sometimes.</p>
<p>We’ll skip this scale-to-a-certain-date step with our example (see the Patterns Vignetter for an example of how this is done), but I will provide some code for doing a year-on-year adjustment, in case you want to combine multiple years of data to see how much more at-home we are this year than last year.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># let's pretend we have another year by just duplicating the data we have</span>
<span class="va">fake_lastyear</span> <span class="op">&lt;-</span> <span class="fu">data.table</span><span class="fu">::</span><span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html">copy</a></span><span class="op">(</span><span class="va">distancing</span><span class="op">)</span>
<span class="va">fake_lastyear</span><span class="op">[</span>,<span class="va">date</span> <span class="op">:=</span> <span class="va">date</span> <span class="op">-</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="http://lubridate.tidyverse.org/reference/period.html">years</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>
<span class="va">fake_lastyear</span><span class="op">[</span>,<span class="va">shrunk_stay_home</span> <span class="op">:=</span> <span class="va">shrunk_stay_home</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">45158</span>, max <span class="op">=</span> <span class="fl">.02</span><span class="op">)</span><span class="op">]</span>

<span class="va">fake_lastyear</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">distancing</span>, <span class="va">fake_lastyear</span><span class="op">)</span>

<span class="va">fake_lastyear_scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/scale_yoy.html">scale_yoy</a></span><span class="op">(</span><span class="va">fake_lastyear</span>,
                                  yoy_vars <span class="op">=</span> <span class="st">'shrunk_stay_home'</span>,
                                  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'state_fips'</span>,<span class="st">'county_fips'</span><span class="op">)</span><span class="op">)</span>

<span class="co"># Notice the "2019" data has no growth since we din't give it 2018 data to grow from</span>
<span class="va">fake_lastyear_scaled</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'date'</span>,<span class="st">'state_fips'</span>,<span class="st">'county_fips'</span>,<span class="st">'shrunk_stay_home'</span>,<span class="st">'shrunk_stay_home_lag'</span>,<span class="st">'shrunk_stay_home_YOY'</span><span class="op">)</span><span class="op">]</span>
<span class="co">#&gt;              date state_fips county_fips shrunk_stay_home shrunk_stay_home_lag</span>
<span class="co">#&gt;     1: 2019-06-01          1         001        0.2055662                   NA</span>
<span class="co">#&gt;     2: 2019-06-02          1         001        0.2162410                   NA</span>
<span class="co">#&gt;     3: 2019-06-03          1         001        0.1991219                   NA</span>
<span class="co">#&gt;     4: 2019-06-04          1         001        0.2136045                   NA</span>
<span class="co">#&gt;     5: 2019-06-05          1         001        0.1926414                   NA</span>
<span class="co">#&gt;    ---                                                                        </span>
<span class="co">#&gt; 90312: 2020-06-10          9         015        0.3387217            0.3227007</span>
<span class="co">#&gt; 90313: 2020-06-11          9         015        0.3652986            0.3490332</span>
<span class="co">#&gt; 90314: 2020-06-12          9         015        0.3314067            0.3277177</span>
<span class="co">#&gt; 90315: 2020-06-13          9         015        0.3072171            0.3056606</span>
<span class="co">#&gt; 90316: 2020-06-14          9         015        0.3535491            0.3519246</span>
<span class="co">#&gt;        shrunk_stay_home_YOY</span>
<span class="co">#&gt;     1:                   NA</span>
<span class="co">#&gt;     2:                   NA</span>
<span class="co">#&gt;     3:                   NA</span>
<span class="co">#&gt;     4:                   NA</span>
<span class="co">#&gt;     5:                   NA</span>
<span class="co">#&gt;    ---                     </span>
<span class="co">#&gt; 90312:          0.049646417</span>
<span class="co">#&gt; 90313:          0.046601080</span>
<span class="co">#&gt; 90314:          0.011256546</span>
<span class="co">#&gt; 90315:          0.005092150</span>
<span class="co">#&gt; 90316:          0.004616098</span></code></pre></div>
</div>
<div id="make-the-data-presentable" class="section level2">
<h2 class="hasAnchor">
<a href="#make-the-data-presentable" class="anchor"></a>3. Make the data presentable!</h2>
<p>Let’s bring in the state and county names for nice labeling</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"fips_to_names"</span><span class="op">)</span>

<span class="co"># We have to do a little class conversions</span>
<span class="va">distancing</span><span class="op">[</span>,<span class="va">state_fips</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">state_fips</span><span class="op">)</span><span class="op">]</span>
<span class="va">distancing</span><span class="op">[</span>,<span class="va">county_fips</span> <span class="op">:=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">county_fips</span><span class="op">)</span><span class="op">]</span>

<span class="co"># And merge in</span>
<span class="va">distancing</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span><span class="op">(</span><span class="va">distancing</span>, <span class="va">fips_to_names</span><span class="op">)</span></code></pre></div>
<p>Let’s take a look at the five boroughs of New York!</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">distancing</span><span class="op">[</span><span class="va">statename</span> <span class="op">==</span> <span class="st">'New York'</span> <span class="op">&amp;</span> 
             <span class="va">countyname</span> <span class="op">%in%</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">'New York'</span>, 
                              <span class="st">'Kings'</span>, 
                              <span class="st">'Queens'</span>,
                              <span class="st">'Bronx'</span>, 
                              <span class="st">'Richmond'</span><span class="op">)</span>,<span class="st">'County'</span><span class="op">)</span><span class="op">]</span> <span class="op">%&gt;%</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">shrunk_stay_home</span>, color <span class="op">=</span> <span class="va">countyname</span>, label <span class="op">=</span> <span class="va">countyname</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">directlabels</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/directlabels/man/geom_dl.html">geom_dl</a></span><span class="op">(</span><span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span> <span class="op">+</span> <span class="fl">.25</span><span class="op">)</span>, method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="st">'last.bumpup'</span>, cex <span class="op">=</span> <span class="fl">1.1</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/label_percent.html">percent</a></span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html">scale_x_date</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">distancing</span><span class="op">$</span><span class="va">date</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">distancing</span><span class="op">$</span><span class="va">date</span><span class="op">)</span> <span class="op">+</span> <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Date"</span>, y <span class="op">=</span> <span class="st">"Proportion Staying Home"</span>, 
                title <span class="op">=</span> <span class="st">"SafeGraph: Stay-at-Home Rates in New York City"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>panel.grid.major.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                 panel.grid.minor.x <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_blank</a></span><span class="op">(</span><span class="op">)</span>,
                 text <span class="op">=</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">14</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; =</span>
<span class="co">#&gt; "none")` instead.</span></code></pre></div>
<p><img src="distancing_vignette_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nick Huntington-Klein.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
